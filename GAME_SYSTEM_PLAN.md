# èŠ±å›­äººç”Ÿ - æ–‡å­—å…»æˆæ¸¸æˆç³»ç»Ÿè®¾è®¡

## é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰ä¸»é¡µç³»ç»Ÿï¼Œæ·»åŠ ä¸€ä¸ªè½»é‡çº§çš„æ–‡å­—å…»æˆæ¸¸æˆï¼ŒèåˆQQç©ºé—´å¼çš„ç¤¾äº¤äº’åŠ¨å’Œé»‘é’»ä¼šå‘˜ç‰¹æƒç³»ç»Ÿã€‚

## æ ¸å¿ƒç©æ³•å¾ªç¯

```
ç­¾åˆ° â†’ è·å¾—ä½“åŠ›/é‡‘å¸ â†’ è§¦å‘éšæœºäº‹ä»¶ â†’ åšé€‰æ‹© â†’ è·å¾—å¥–åŠ± 
  â†“                                              â†“
èŠ±å›­ç§æ¤ â† ä½¿ç”¨é“å…·/ç§å­ â† æ”¶è·ä½œç‰© â† ç­‰å¾…æˆç†Ÿ
  â†“
å¥½å‹äº’åŠ¨ï¼ˆæµ‡æ°´/é€ç¤¼/å·èœï¼‰â†’ å¢åŠ å¥½æ„Ÿåº¦/è·å¾—å¥–åŠ±
  â†“
å‘¨æ¦œ/æœˆæ¦œ â†’ è·å¾—é™å®šå¥–åŠ±
```

## æ•°æ®æ¨¡å‹

### 1. ç”¨æˆ·æ¸¸æˆæ¡£æ¡ˆ (game_profiles)
```javascript
{
  email: "user@example.com",
  energy: 100,              // å½“å‰ä½“åŠ›
  maxEnergy: 100,           // æœ€å¤§ä½“åŠ›
  coins: 1000,              // é‡‘å¸
  exp: 0,                   // æ¸¸æˆç»éªŒ
  gameLevel: 1,             // æ¸¸æˆç­‰çº§
  inventory: {              // èƒŒåŒ…
    seed_common: 5,
    fertilizer: 2
  },
  status: {                 // çŠ¶æ€å€¼
    luck: 0,
    friendship: 0,
    fatigue: 0
  },
  dailyEvents: 0,           // ä»Šæ—¥äº‹ä»¶æ¬¡æ•°
  lastEnergyRecover: "2024-01-01T00:00:00Z",
  lastDailyReset: "2024-01-01",
  totalHarvest: 0,          // æ€»æ”¶è·ï¼ˆç”¨äºæ’è¡Œæ¦œï¼‰
  totalHelp: 0,             // æ€»åŠ©äººæ¬¡æ•°
  blackDiamond: {           // é»‘é’»çŠ¶æ€
    active: false,
    level: 0,
    expireAt: null
  },
  createdAt: "2024-01-01T00:00:00Z",
  updatedAt: "2024-01-01T00:00:00Z"
}
```

### 2. èŠ±å›­æ•°æ® (game_farms)
```javascript
{
  email: "user@example.com",
  plots: [
    {
      id: 0,
      planted: true,
      seedType: "seed_common",
      plantedAt: "2024-01-01T00:00:00Z",
      harvestAt: "2024-01-01T02:00:00Z",
      stolen: 0,              // è¢«å·æ¬¡æ•°
      watered: 0,             // è¢«æµ‡æ°´æ¬¡æ•°
      protected: false,       // æ˜¯å¦å—ä¿æŠ¤
      protectedUntil: null
    }
  ],
  visitors: [],               // è®¿å®¢è®°å½•
  lastVisit: {}               // æœ€åè®¿é—®æ—¶é—´ï¼ˆé˜²åˆ·ï¼‰
}
```

### 3. æ¸¸æˆæµæ°´ (game_ledger)
```javascript
{
  id: "ledger_xxx",
  email: "user@example.com",
  type: "coins" | "energy" | "item",
  action: "earn" | "spend",
  amount: 10,
  itemId: "seed_common",
  reason: "event_reward",
  eventId: "event_1",
  timestamp: "2024-01-01T00:00:00Z"
}
```

### 4. æ’è¡Œæ¦œ (game_rankings)
```javascript
{
  weekly: [
    { email: "user@example.com", score: 1000, rank: 1 }
  ],
  monthly: [],
  lastWeeklyReset: "2024-01-01",
  lastMonthlyReset: "2024-01-01"
}
```

## API æ¥å£è®¾è®¡

### å…¬å¼€æ¥å£

#### 1. è·å–æ¸¸æˆé…ç½®
```
GET /api/game/config
Response: { enabled, maxEnergy, dailyEventLimit, ... }
```

#### 2. è·å–ç”¨æˆ·æ¸¸æˆæ¡£æ¡ˆ
```
GET /api/game/profile?email=xxx
Response: { energy, coins, inventory, ... }
```

#### 3. æ¸¸æˆç­¾åˆ°
```
POST /api/game/checkin
Body: { email }
Response: { success, rewards: { energy: 20, coins: 50 } }
```

#### 4. è·å–éšæœºäº‹ä»¶
```
POST /api/game/event/next
Body: { email }
Response: { eventId, title, description, options: [...] }
```

#### 5. é€‰æ‹©äº‹ä»¶é€‰é¡¹
```
POST /api/game/event/choose
Body: { email, eventId, optionIndex }
Response: { success, rewards: {...}, newStatus: {...} }
```

#### 6. ç§æ¤ä½œç‰©
```
POST /api/game/farm/plant
Body: { email, plotId, seedType }
Response: { success, harvestAt }
```

#### 7. æ”¶è·ä½œç‰©
```
POST /api/game/farm/harvest
Body: { email, plotId }
Response: { success, rewards: {...} }
```

#### 8. è®¿é—®å¥½å‹èŠ±å›­
```
POST /api/game/farm/visit
Body: { email, targetEmail, action: "water|steal|gift" }
Response: { success, rewards: {...} }
```

#### 9. ä½¿ç”¨é“å…·
```
POST /api/game/item/use
Body: { email, itemId, targetPlotId }
Response: { success, effect: {...} }
```

#### 10. è·å–æ’è¡Œæ¦œ
```
GET /api/game/rankings?type=weekly|monthly&limit=50
Response: { rankings: [...] }
```

### ç®¡ç†å‘˜æ¥å£

#### 1. è·å–æ¸¸æˆé…ç½®
```
GET /api/admin/game/config
```

#### 2. æ›´æ–°æ¸¸æˆé…ç½®
```
PUT /api/admin/game/config
Body: { enabled, maxEnergy, ... }
```

#### 3. ç®¡ç†æ¸¸æˆäº‹ä»¶
```
GET /api/admin/game/events
POST /api/admin/game/events
PUT /api/admin/game/events/:id
DELETE /api/admin/game/events/:id
```

#### 4. ç®¡ç†æ¸¸æˆé“å…·
```
GET /api/admin/game/items
POST /api/admin/game/items
PUT /api/admin/game/items/:id
DELETE /api/admin/game/items/:id
```

#### 5. æŸ¥çœ‹æ¸¸æˆç»Ÿè®¡
```
GET /api/admin/game/stats
Response: { totalPlayers, activeToday, totalCoins, ... }
```

#### 6. å‘æ”¾å¥–åŠ±
```
POST /api/admin/game/grant
Body: { email, type: "coins|energy|item", amount, itemId }
```

## é»‘é’»ä¼šå‘˜ç‰¹æƒ

### ç‰¹æƒåˆ—è¡¨

1. **ä½“åŠ›ä¸Šé™ +20%** (100 â†’ 120)
2. **ç¦»çº¿ç”Ÿé•¿åŠ é€Ÿ 20%**
3. **æ¯æ—¥é˜²å·ä¿æŠ¤ç½© x1**
4. **ä¸€é”®æ”¶è·/æµ‡æ°´**
5. **æ–­ç­¾ä¿æŠ¤ï¼ˆ7å¤©å†…å¯è¡¥ç­¾ï¼‰**
6. **é»‘é’»ä¸“å±è¾¹æ¡†å’Œç§°å·**
7. **äº‹ä»¶é€‰é¡¹æç¤ºï¼ˆæ˜¾ç¤ºå€¾å‘ï¼‰**
8. **èƒŒåŒ…ä¸Šé™æå‡ 50%**
9. **æ¯æ—¥é¢å¤–äº‹ä»¶æ¬¡æ•° +5**
10. **é»‘é’»ä¸“å±äº‹ä»¶**

### é»‘é’»ç­‰çº§

- **é»‘é’»1çº§**ï¼šè¿ç»­è®¢é˜…1ä¸ªæœˆï¼ŒåŸºç¡€ç‰¹æƒ
- **é»‘é’»2çº§**ï¼šè¿ç»­è®¢é˜…3ä¸ªæœˆï¼Œ+10%æ”¶ç›ŠåŠ æˆ
- **é»‘é’»3çº§**ï¼šè¿ç»­è®¢é˜…6ä¸ªæœˆï¼Œ+20%æ”¶ç›ŠåŠ æˆ
- **é»‘é’»4çº§**ï¼šè¿ç»­è®¢é˜…12ä¸ªæœˆï¼Œ+30%æ”¶ç›ŠåŠ æˆ + ä¸“å±å¤–è§‚

## å‰ç«¯é¡µé¢ç»“æ„

### æ¸¸æˆä¸»é¡µ (game.html)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¡ èŠ±å›­äººç”Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä½“åŠ›     â”‚  â”‚ é‡‘å¸     â”‚  â”‚ ç­‰çº§     â”‚ â”‚
â”‚  â”‚ 80/100  â”‚  â”‚ 1,234   â”‚  â”‚ Lv.5    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç­¾åˆ°] [éšæœºäº‹ä»¶] [èŠ±å›­] [å¥½å‹] [å•†åº—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  ä¸»è¦å†…å®¹åŒºåŸŸï¼ˆæ ¹æ®é€‰é¡¹å¡åˆ‡æ¢ï¼‰           â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éšæœºäº‹ä»¶é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“œ ä»Šæ—¥å¥‡é‡ (3/10)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¯è¿‡èŠ±å¸‚                                 â”‚
â”‚  ä½ è·¯è¿‡èŠ±å¸‚ï¼Œçœ‹åˆ°ä¸€ä½è€äººåœ¨å–ç§å­...      â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ’° èŠ±10é‡‘å¸ä¹°ä¸€åŒ…ç§å­                 â”‚â”‚
â”‚  â”‚ ğŸ’ èŠ±50é‡‘å¸ä¹°ç¨€æœ‰ç§å­                 â”‚â”‚
â”‚  â”‚ ğŸ’¬ å’Œè€äººèŠå¤©                         â”‚â”‚
â”‚  â”‚ ğŸš¶ ç¦»å¼€                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŠ±å›­é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ» æˆ‘çš„èŠ±å›­                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸŒ±  â”‚  â”‚ ğŸŒº  â”‚  â”‚     â”‚  â”‚     â”‚   â”‚
â”‚  â”‚æˆç†Ÿä¸­â”‚  â”‚ 2h  â”‚  â”‚ ç©º  â”‚  â”‚ ç©º  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  [ä¸€é”®æ”¶è·] [ç§æ¤] [ä½¿ç”¨é“å…·]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è®¿å®¢è®°å½•ï¼š                               â”‚
â”‚  â€¢ å°æ˜ æµ‡æ°´äº†ä½ çš„èŠ±å›­ (+5ç»éªŒ)           â”‚
â”‚  â€¢ å°çº¢ å·èµ°äº† 3 ä¸ªæœå®                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®ç°ä¼˜å…ˆçº§

### Phase 1: MVP (2å‘¨)
- [x] æ•°æ®æ¨¡å‹è®¾è®¡
- [ ] åŸºç¡€APIæ¥å£ï¼ˆç­¾åˆ°ã€äº‹ä»¶ã€èŠ±å›­ï¼‰
- [ ] æ¸¸æˆä¸»é¡µUI
- [ ] éšæœºäº‹ä»¶ç³»ç»Ÿ
- [ ] èŠ±å›­ç§æ¤ç³»ç»Ÿ
- [ ] é»‘é’»åŸºç¡€ç‰¹æƒ

### Phase 2: ç¤¾äº¤ (1å‘¨)
- [ ] å¥½å‹è®¿é—®ç³»ç»Ÿ
- [ ] æµ‡æ°´/å·èœ/é€ç¤¼
- [ ] è®¿å®¢è®°å½•
- [ ] å¥½å‹åˆ—è¡¨

### Phase 3: è¿›é˜¶ (1å‘¨)
- [ ] æ’è¡Œæ¦œç³»ç»Ÿ
- [ ] å‘¨èµ›/æœˆèµ›
- [ ] æˆå°±ç³»ç»Ÿ
- [ ] å•†åº—ç³»ç»Ÿ

### Phase 4: ä¼˜åŒ– (æŒç»­)
- [ ] è¿é”äº‹ä»¶
- [ ] æ›´å¤šé“å…·å’Œä½œç‰©
- [ ] é»‘é’»é«˜çº§ç‰¹æƒ
- [ ] èµ›å­£é€šè¡Œè¯

## é˜²åˆ·å’Œå®‰å…¨

1. **å¹‚ç­‰æ€§**ï¼šæ‰€æœ‰å¥–åŠ±æ¥å£ä½¿ç”¨å”¯ä¸€ID
2. **æœåŠ¡ç«¯è®¡ç®—**ï¼šæ‰€æœ‰æ”¶ç›ŠæœåŠ¡ç«¯è®¡ç®—ï¼Œå‰ç«¯åªå±•ç¤º
3. **æ—¥ä¸Šé™**ï¼šäº‹ä»¶æ¬¡æ•°ã€è®¿é—®æ¬¡æ•°ã€å·èœæ¬¡æ•°
4. **å†·å´æ—¶é—´**ï¼šé«˜ä»·å€¼äº‹ä»¶æœ‰å†·å´
5. **æµæ°´è®°å½•**ï¼šæ‰€æœ‰èµ„äº§å˜åŠ¨è®°å½•ledger
6. **å¼‚å¸¸æ£€æµ‹**ï¼šç›‘æ§å¼‚å¸¸å¢é•¿ï¼Œè‡ªåŠ¨å°ç¦

## æ•°å€¼å¹³è¡¡

### ä½“åŠ›ç³»ç»Ÿ
- åˆå§‹ä½“åŠ›ï¼š100
- æ¢å¤é€Ÿç‡ï¼š10/å°æ—¶
- é»‘é’»åŠ æˆï¼š120æœ€å¤§ä½“åŠ›
- äº‹ä»¶æ¶ˆè€—ï¼š5-30ä½“åŠ›

### é‡‘å¸ç³»ç»Ÿ
- ç­¾åˆ°å¥–åŠ±ï¼š50é‡‘å¸
- äº‹ä»¶å¥–åŠ±ï¼š10-150é‡‘å¸
- æ‰“å·¥æ”¶ç›Šï¼š30-80é‡‘å¸
- ç§å­æˆæœ¬ï¼š10-50é‡‘å¸
- ä½œç‰©æ”¶ç›Šï¼š50-200é‡‘å¸

### ç»éªŒç³»ç»Ÿ
- ç­¾åˆ°ï¼š20ç»éªŒ
- äº‹ä»¶ï¼š5-15ç»éªŒ
- æ”¶è·ï¼š10-30ç»éªŒ
- åŠ©äººï¼š10ç»éªŒ
- å‡çº§æ‰€éœ€ï¼šç­‰çº§ * 100

## æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šCloudflare Workers + KV Storage
- **å‰ç«¯**ï¼šåŸç”ŸHTML + CSS + JavaScript
- **æ•°æ®å­˜å‚¨**ï¼šJSONæ ¼å¼å­˜å‚¨åœ¨KV
- **å®æ—¶æ€§**ï¼šè½®è¯¢ï¼ˆ10ç§’é—´éš”ï¼‰

## å¼€å‘è®¡åˆ’

1. **Day 1-2**ï¼šå®Œæˆæ•°æ®æ¨¡å‹å’ŒåŸºç¡€API
2. **Day 3-4**ï¼šå®ç°æ¸¸æˆä¸»é¡µå’Œäº‹ä»¶ç³»ç»Ÿ
3. **Day 5-6**ï¼šå®ç°èŠ±å›­ç³»ç»Ÿ
4. **Day 7-8**ï¼šå®ç°é»‘é’»ç³»ç»Ÿ
5. **Day 9-10**ï¼šæµ‹è¯•å’Œä¼˜åŒ–
6. **Day 11-12**ï¼šæ·»åŠ ç¤¾äº¤åŠŸèƒ½
7. **Day 13-14**ï¼šå®Œå–„UIå’Œæ–‡æ¡£

## åç»­æ‰©å±•

1. äº¤æ˜“ç³»ç»Ÿï¼ˆç©å®¶é—´äº¤æ˜“ï¼‰
2. å…¬ä¼šç³»ç»Ÿ
3. PVPç«æŠ€åœº
4. æ›´å¤šä½œç‰©å’Œé…æ–¹
5. èŠ‚æ—¥æ´»åŠ¨
6. é™æ—¶æŒ‘æˆ˜

