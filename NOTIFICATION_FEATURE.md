# 实时弹幕/祝贺通知功能

## 功能概述

这个功能为网站添加了实时通知系统，当用户升级或获得稀有勋章时，会在页面右上角显示祝贺通知，增强社区氛围。

## 主要特性

### 1. 实时通知显示
- **位置**：页面右上角
- **动画**：从右侧滑入，自动淡出
- **类型**：
  - 升级通知：显示用户名、新等级、等级徽章
  - 勋章通知：显示用户名、勋章图标、勋章名称

### 2. 通知触发时机
- 用户签到升级时自动触发
- 管理员授予勋章时自动触发
- 管理员发放经验导致升级时自动触发

### 3. 虚拟数据支持
- 管理员可以生成虚拟通知数据
- 支持批量生成升级通知和勋章通知
- 使用随机用户名营造社区氛围

## 后台管理功能

### 通知配置
1. **启用/禁用通知**：全局开关
2. **显示升级通知**：控制是否显示升级通知
3. **显示勋章通知**：控制是否显示勋章获得通知
4. **通知显示时长**：设置每条通知停留时间（1-30秒）
5. **最大保留通知数**：控制历史记录数量（10-500条）
6. **启用虚拟数据**：允许生成虚拟通知

### 虚拟通知生成
- **生成1条升级通知**：快速生成单条升级通知
- **生成1条勋章通知**：快速生成单条勋章通知
- **生成5条混合通知**：批量生成多种类型通知
- **清空所有通知**：清除所有历史记录

### 通知历史记录
- 查看最近20条通知记录
- 显示通知类型、内容、时间

## API 接口

### 公开接口

#### 获取最新通知
```
GET /api/notifications?limit=20
```
返回最新的N条通知记录

#### 获取通知配置
```
GET /api/notification-config
```
返回通知系统配置

### 管理员接口

#### 获取通知配置
```
GET /api/admin/notification-config
```

#### 更新通知配置
```
PUT /api/admin/notification-config
Body: {
  enabled: true,
  showLevelUp: true,
  showRareBadge: true,
  displayDuration: 5000,
  maxNotifications: 50,
  virtualDataEnabled: false
}
```

#### 获取所有通知
```
GET /api/admin/notifications
```

#### 创建虚拟通知
```
POST /api/admin/notifications/virtual
Body: {
  type: 'levelup' | 'badge' | null,  // null表示混合
  count: 5
}
```

#### 清空通知
```
DELETE /api/admin/notifications
```

## 前端实现

### 通知容器
位于 `index.html` 底部：
```html
<div id="notification-container" class="notification-container">
  <!-- 通知将通过 JS 动态加载 -->
</div>
```

### 通知检查机制
- 每10秒自动检查一次新通知
- 使用通知ID避免重复显示
- 一次最多显示3条新通知
- 每条通知间隔500ms显示

### 通知样式
- 响应式设计，支持移动端
- 悬停效果：向左移动
- 点击关闭：点击通知可手动关闭
- 自动关闭：根据配置时长自动消失

## 数据结构

### 通知对象
```javascript
{
  id: "唯一标识",
  type: "levelup" | "badge",
  timestamp: "ISO时间戳",
  email: "用户邮箱",
  virtualName: "虚拟用户名（可选）",
  
  // 升级通知特有字段
  level: 5,
  levelConfig: { /* 等级配置 */ },
  
  // 勋章通知特有字段
  badgeId: "emperor",
  badgeName: "皇上",
  badgeIcon: "👑",
  badgeColor: "#FFD700"
}
```

### 通知配置对象
```javascript
{
  enabled: true,              // 是否启用
  showLevelUp: true,          // 显示升级通知
  showRareBadge: true,        // 显示勋章通知
  displayDuration: 5000,      // 显示时长（毫秒）
  maxNotifications: 50,       // 最大保留数量
  virtualDataEnabled: false   // 启用虚拟数据
}
```

## 使用场景

### 1. 真实用户互动
- 用户签到升级时，全站用户看到祝贺
- 管理员授予稀有勋章时，营造稀缺感

### 2. 社区氛围营造
- 使用虚拟数据模拟活跃社区
- 定期生成通知增加互动感
- 新用户访问时看到活跃氛围

### 3. 运营活动
- 活动期间批量生成通知
- 引导用户参与升级和勋章系统
- 提升用户留存和活跃度

## 注意事项

1. **性能优化**：
   - 通知检查间隔为10秒，避免频繁请求
   - 最多保留配置数量的历史记录
   - 一次最多显示3条新通知

2. **用户体验**：
   - 通知可点击关闭
   - 移动端自适应布局
   - 不影响页面正常使用

3. **数据管理**：
   - 定期清理历史通知
   - 虚拟数据使用随机名称
   - 真实用户使用邮箱前缀

## 未来扩展

1. 支持更多通知类型（评论、点赞等）
2. 添加通知音效
3. 支持用户自定义通知偏好
4. 添加通知统计和分析
5. 支持通知推送到其他渠道

