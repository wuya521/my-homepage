<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šçŸ¥åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body {
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }
        .test-section h2 {
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }
        .test-buttons {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        .test-buttons button {
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--primary-gradient);
            color: #FFFFFF;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .test-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h2>ğŸ”” å®æ—¶é€šçŸ¥åŠŸèƒ½æµ‹è¯•</h2>
        <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
            ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ä¸åŒç±»å‹çš„é€šçŸ¥æ•ˆæœ
        </p>
        <div class="test-buttons">
            <button onclick="testLevelUpNotification()">æµ‹è¯•å‡çº§é€šçŸ¥</button>
            <button onclick="testBadgeNotification()">æµ‹è¯•å‹‹ç« é€šçŸ¥</button>
            <button onclick="testMultipleNotifications()">æµ‹è¯•å¤šæ¡é€šçŸ¥</button>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š é€šçŸ¥é…ç½®çŠ¶æ€</h2>
        <div id="config-status" style="color: var(--text-secondary);">
            åŠ è½½ä¸­...
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“œ æœ€è¿‘é€šçŸ¥è®°å½•</h2>
        <div id="recent-notifications" style="color: var(--text-secondary);">
            åŠ è½½ä¸­...
        </div>
    </div>

    <!-- å®æ—¶é€šçŸ¥å®¹å™¨ -->
    <div id="notification-container" class="notification-container"></div>

    <script src="/static/script.js"></script>
    <script>
        // æµ‹è¯•å‡çº§é€šçŸ¥
        function testLevelUpNotification() {
            const notification = {
                id: Date.now().toString(),
                type: 'levelup',
                timestamp: new Date().toISOString(),
                email: 'test@example.com',
                virtualName: 'æµ‹è¯•ç”¨æˆ·',
                level: Math.floor(Math.random() * 10) + 1,
                levelConfig: {
                    levels: [
                        { level: 1, title: 'åº¶æ°‘', badge: 'ğŸª¶' },
                        { level: 2, title: 'æ–°ä¸', badge: 'ğŸŒ±' },
                        { level: 3, title: 'å°å', badge: 'ğŸ“œ' },
                        { level: 4, title: 'ä»ä¹å“', badge: 'ğŸ”°' },
                        { level: 5, title: 'æ­£ä¹å“', badge: 'ğŸŸ©' }
                    ]
                }
            };
            showNotification(notification);
        }

        // æµ‹è¯•å‹‹ç« é€šçŸ¥
        function testBadgeNotification() {
            const badges = [
                { name: 'çš‡ä¸Š', icon: 'ğŸ‘‘', color: '#FFD700' },
                { name: 'çš‡å', icon: 'ğŸ‘¸', color: '#FF69B4' },
                { name: 'è´¢æ”¿å¤§è‡£', icon: 'ğŸ’°', color: '#32CD32' },
                { name: 'ç¤¼éƒ¨å°šä¹¦', icon: 'ğŸ“œ', color: '#9370DB' },
                { name: 'é€†è¡Œè€…', icon: 'ğŸ¦¸', color: '#FF4500' }
            ];
            const badge = badges[Math.floor(Math.random() * badges.length)];
            
            const notification = {
                id: Date.now().toString(),
                type: 'badge',
                timestamp: new Date().toISOString(),
                email: 'test@example.com',
                virtualName: 'æµ‹è¯•ç”¨æˆ·',
                badgeId: 'test',
                badgeName: badge.name,
                badgeIcon: badge.icon,
                badgeColor: badge.color
            };
            showNotification(notification);
        }

        // æµ‹è¯•å¤šæ¡é€šçŸ¥
        function testMultipleNotifications() {
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    if (i % 2 === 0) {
                        testLevelUpNotification();
                    } else {
                        testBadgeNotification();
                    }
                }, i * 600);
            }
        }

        // åŠ è½½é…ç½®çŠ¶æ€
        async function loadConfigStatus() {
            try {
                const config = await apiRequest('/api/notification-config');
                const statusEl = document.getElementById('config-status');
                statusEl.innerHTML = `
                    <p><strong>å¯ç”¨çŠ¶æ€ï¼š</strong>${config.enabled ? 'âœ… å·²å¯ç”¨' : 'âŒ å·²ç¦ç”¨'}</p>
                    <p><strong>æ˜¾ç¤ºå‡çº§é€šçŸ¥ï¼š</strong>${config.showLevelUp ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>
                    <p><strong>æ˜¾ç¤ºå‹‹ç« é€šçŸ¥ï¼š</strong>${config.showRareBadge ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>
                    <p><strong>æ˜¾ç¤ºæ—¶é•¿ï¼š</strong>${config.displayDuration}ms</p>
                    <p><strong>æœ€å¤§ä¿ç•™æ•°ï¼š</strong>${config.maxNotifications}æ¡</p>
                `;
            } catch (error) {
                document.getElementById('config-status').textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
            }
        }

        // åŠ è½½æœ€è¿‘é€šçŸ¥
        async function loadRecentNotifications() {
            try {
                const result = await apiRequest('/api/notifications?limit=5');
                const notifications = result.notifications || [];
                const listEl = document.getElementById('recent-notifications');
                
                if (notifications.length === 0) {
                    listEl.textContent = 'æš‚æ— é€šçŸ¥è®°å½•';
                    return;
                }
                
                listEl.innerHTML = notifications.map(n => {
                    const time = new Date(n.timestamp).toLocaleString('zh-CN');
                    let content = '';
                    if (n.type === 'levelup') {
                        const userName = n.virtualName || n.email?.split('@')[0] || 'ç”¨æˆ·';
                        content = `${userName} å‡çº§åˆ° Lv.${n.level}`;
                    } else if (n.type === 'badge') {
                        const userName = n.virtualName || n.email?.split('@')[0] || 'ç”¨æˆ·';
                        content = `${userName} è·å¾—å‹‹ç«  ${n.badgeIcon} ${n.badgeName}`;
                    }
                    return `<p style="margin: 8px 0;">â€¢ ${content} (${time})</p>`;
                }).join('');
            } catch (error) {
                document.getElementById('recent-notifications').textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadNotificationConfig().then(() => {
                loadConfigStatus();
                loadRecentNotifications();
            });
        });
    </script>
</body>
</html>

